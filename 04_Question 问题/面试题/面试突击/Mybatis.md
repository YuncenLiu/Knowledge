[toc]

## MyBatis

​		Mybatis 是apache的一款开源项目 ibatis，后面迁移到了 github 上才改名为 Myabtis，Mybatis 发展到现在已经非常成熟了，他是一款非常出色的持久层框架，其中最大的特点就是动态SQL部分，可以帮助程序员更加关注业务逻辑，通过提供dao层，实现业务逻辑与数据访问逻辑之间的分离。

​		首先呢，SqlSessionFactoryBuild 通过 xml 的配置文件，构建出 sqlsessionFactory ，这个配置文件里，就需要包含数据库的连接信息。sqlsessionFactory 读取连接信息和 mapper 映射信息，工厂生产出 真正能操作数据库的 sqlsession ，SqlSession 有两大特点，一个是通过接口代理对象 xml配置方法， 二是定义通常的crud方法， 无论用到什么方法，最终都要对返回的结果进行封装，变成java对象返回给调用者。

​		手动搭建 Mybatis 的步骤 1、首先得到dao层接口的字节码对象， 2、扫描dao层拿到所有方法数组，3、遍历方法 4、取出每个方法，判断是否有 select 注解，如果有，取出里面的 value值，这里的value 值是SQL语句里，所以非常重要。5、获取当前方法的返回值。 有了这些信息，就可以使用 jdbc 去进行查询，最后封装成返回方法给他返回去了。

### JDBC

​		其中 JDBC 常用方法，无外乎就那几点，1、拿到连接信息，2、建立连接，3、创建数据库操作对象，4、定义sql语句，5、执行语句，6、拿到结果集。

跟踪 Mybatis 操作，从 DefaultSqlSession ， 最终还是执行的 ParaerStatmet 的方法 ps.execut()

### 连接池

​		Mybatis 默认提供了三种方式， POOLED 采用窜痛的 DataSource， UNPOOLED 不用连接池，每次连接一个一个拿，JNDI ，这个技术就很古老了，我记得这个需要配置在容器里，在 Tomcat 的配置里，其中 连接池中，有 Synchronzied 关键字，因此，我们可以判断，线程池是需要线程同步的 （我们不对多线程进行展开），如果我们要用了，就去池里拿一个，不够用，要么就new ，要么就clean。涉及到具体数量，肯定是可以配置的，所以，我们可以在mybatis的相关配置里，去配置连接池数量、

### 事务

​		事务属性：原子、一致、隔离、持久。  事务创建分为 隐形、显型，显性就需要手动去提交活回滚了，

不考虑隔离的话出现的三个问题：1、胀读、不重复读、幻读。

处理结果：读取未提交内容、读取提交内容、重复读、可串行化，大多数数据库默认是 读取提交内容，

### 延迟加载策略

立即加载、懒加载，一对多、多对多 的情况，可以使用懒加载

多对一、一对一，立即加载

### Mybatis 的缓存

使用缓存，可以减少数据库的交互此时，提高执行效率。一般适用于查询无关紧要的东西，正确无所谓的。缓存分为 一级缓存、二级缓存





