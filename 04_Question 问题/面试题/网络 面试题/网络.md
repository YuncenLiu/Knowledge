## http 网络知识

当你的电脑连接互联网的时候，你的电脑会获得一个地址，这个地址就是 internet Protocol address IP，我们经常看的一个网页，Bilibili，他也连接到了 互联网，也分配到了要 IP地址，我们经常说访问一个网站，其实就是访问他的服务器，假设你的电脑想访问 index.html 来获取数据，这个时候，我们称 我们电脑为客户端、Bilibili 服务器为服务端，这种形式就是 客户端和服务器模型，顾名思义，客户端更贴切于用户、是面向用户的应用程序，比如 web浏览器，电子邮件客户端，手机APP，服务端是在远程计算机上运行的应用程序，客户端可以在需要的时候，通过互联网与服务端进行通信，比如电脑发送消息给 Bilibili服务器，要获取 Index 的内容，请把他穿给我，消息将会被转换成电子信号，通过电缆、光纤发送给服务器，服务器端把电子信号转换成计算机使用文本数据，

这一切，是如何实现呢，其实就是 TCP/IP 协议

协议是一种规则，指定计算机如何利用网络来进行通讯 

协议分为 4 层， 应用层、TCP 传输控制层、IP 网络层、链路层  每个层有各自的工作，通过定义明确的接口来协同工作，不用去担心各层是如何实现的

应用层，负责提供特定应用程序的协议、 http 网络协议、 ftp 文件传输协议、IMAP 电子邮件 协议

传输控制层 ，发送数据包到计算机上使用特定端口号的应用程序

网络层，使用IP地址将数据包发送到特定的计算机

链路层，将二进制数据包与网络信号相互转换



客户端消息在发送前会被分为许多片段，我们称为数据包，通过应用程进入TCP层后，每个数据包都会被分配一个端口号，端口确定目标计算机的哪一个应用程序，到接受并使用改数据包

TCP 是一种面向连接的可靠字节流服务器，注意是 面向连接  、 可靠   为什么可靠呢，因为 TCP 必须三次握手建立连接之后才能交换数据，每个收到的数据包都会像发送方发送ack确认，以确保发送成功，进入IP层后，每个数据包将会赋予目标计算机的IP地址，IP 是可靠的无连接协议，他是不关心数据包是否到达目的地，也不关心连接的端口号，他的工作是发送数据包并将其路由到目标计算机，其中每个数据包都是独立的互不依赖的。所以有可能会乱序到达目标地址，或者在传输图中丢失。如何保证顺利到达呢？这都交给了TCP 分层的作用，当数据包过大时，在IP层会进行分包，每个数据在物理链路层走的物理链路不一样，传输速度也不一样，导致数据包没有按顺序到达。但TCP会根据数据包携带的序列号来进行排序重组，并且发送方在特定时间内没有接收到 ack确认时，则发送方会重新发送数据包

在某些意义程度上，IP 是不等于 IP 地址的。IP 是网络层协议，而IP地址是一串数字 IP地址有两种 internet protcol version 4  IPV4，IPv4采用32位地址，4字节，空间只有2的32次方，大概40移，专用地址有 一千八百万个，多播地址有2.7亿个，减少了可用数量。 逐渐会导致枯竭，IPV6因此诞生，IPV6 采用了 128位，   在目前来看，足够用了，假设地球70亿人，每人都可以再分配70亿个ip地址，链路层将电子信号转换成 数据文本，10101010110

一个数据包  由目标IP 源IP 目标端口 源端口 数据  组成，通过 转换成电子信号由链路层 再通过电缆到互联网，到指定计算机的 链路层，再上逐步脱离，先把数据转换成可读数据到网络层，再去掉 目标IP 源 IP 到 传输协议层，最终剥离 剩下数据到 应用层，当数据到栈顶 的时候，数据已经可以使用了，应用程序根据当前请求数据做出反应，

比如我们想获取 index.html 这个时候，Bilibili 服务器会将 index.html 以刚刚的形式传输回来，这样你就看到 index.html 页面。



我们现在再看从更广的角度来看互联网是如何构成的

我们电脑通过 调制调节器 modem 也就是猫，猫将电子信号翻译成可沿电话线传送的模拟信号，在公共电话网进行传输，公共电话网通过连接 internet service provider 简称 ISP 互联网服务提供商，来接入互联网，比如... 中国移动、中国电信、中国联通，数据包经过ISP后，将路由到 ISP 的主干网络，数据包会从此经过多个路由器，并经过多个主干网络直到找到目的地 ，互联网骨干网，是由许多相关连接的大型网络组成，这些大型网络被称为 网络服务提供商，简称 NSP，NSP 是为 ISP 提供主干网络的主干服务器公司，ISP 可以从 NSP那批量购入带宽，为客户提供网络接入服务，NSP网络通过网络访问节点NAP 相连来交换数据包，每个NSP 都必须连接到至少三个网络访问点，数据包流量可以通过 NSP 的主干跳到另一个NSP 的主干，当然咯，互联网的网络架构并没有这么简单，就简单的跳一跳... 

互联网的如此复杂，是如何帮数据包找到一个正确的路线呢？

在互联网中有一个特殊的计数器——路由器，路由器上有个路由表，记录了其子网络的所有IP地址，但是他并不知道上层网络的IP地址，当数据包到达路由器，他会检查路由表是否有目标IP地址，如果有，则直接发送给那个网络，因此，我们可以实现在不接入互联网的情况下，利用局域网，链接去打单机游戏...  红警、魔兽，否则的话，向上一层发送数据，在更高的层级寻找拥有该IP 的路由器，如果依然没有找到，则再次将数据包向上路由，直到到达NSP主干网络的路由器，拥有最大的路由表，通过这个表，找到正确的路由，开始向下传播，进入越来越小的网络，直到找到目的地为止，你的电脑就是这样访问到 Bilibili 服务器的

我们经常去记一大串数字也不太方便，如果更换了IP地址，那就会导致找不到数据，由此，我们就可以使用  Domain Names Service 简称 DNS，域名，DNS 是一个分布式数据库，上面记录了域名和其IP地址的对应关系，在浏览器中输入网址，浏览器先链接到 DNS 服务器，DNS 找到对应的 IP地址，浏览器再访问对应的IP就行，有了DNS 即使想换IP地址了，重新绑定一下域名就可以了，这样就不会影响到服务站点的用户。现在，当你打开浏览器，输入 www.bilibili.com 时，你就知道了是如何连接互联网的，访问bilibili 服务器再返回页面数据到电脑上的。