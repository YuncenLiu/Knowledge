### 方案一：外部数据导入

利用关系型数据存储数据，在 ElasticSearch中查询启到加速作用，如果需要重建索引，只需要把关系型数据数据灌到 ElasticSearch 中即可

1. 通过 MQ 的 Web 控制台或 cli 命令发送指定 MQ 消息
2. MQ 消息被微服务消费，触发 ES 重新导入
3. 微服务从数据库里查询数据，获取结构，组装成JSON，执行 bulk 命令，发送给 ES 集群。完成重建工作

特点：

1. MQ 不做要求
2. 微服务方面需要事前开发好接口，共用一个 Topic，每个索引都有单独的结构
3. 利用 MQ 异步机制，充分发挥并发优势，加快数据重建速度

缺点：

1. 关系型数据库压力大、网络带宽
2. 数据重建时间长，跟迁移量大小有关



### 方案二：scroll+bulk 索引别名

不依赖关系型数据库，利用 ElasticSearch 自带工具完成索引重建工作

1. 创建别名 `PUT /book/_alias/book_alias`
2. 使用 scroll 告诉 ES 保存搜索上下文 1分钟 `GET /book/_search?scroll=1m`

3. 采用 bulk 将 scoll 查出来的数据插入新索引
4. 反复修改步骤2、3 直到插入完成
5. 切换别名 `POST /_aliases`

特点：

1. 数据传输基本自足，不需要其他数据源，网络带宽较小
2. 《tip》 使用别名是个好习惯



### 方案三：Reindex API 方案

从 ElasticSearch V6.3.1 就可以支持了，它对 scroll bulk 做了封装

新索引需要指定映射，否则会成为默认映射`_mapping`

提供了大量的 API 可以有很多方案