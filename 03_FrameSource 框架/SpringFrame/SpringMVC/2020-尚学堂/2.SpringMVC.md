## 1ã€JSP ä¹å¤§å†…ç½®å¯¹è±¡å’Œå››å¤§åŸŸå¤ä¹ 

1. ä¹å¤§å†…ç½®å¯¹è±¡

     |    åç§°     |        ç±»å‹         |       ä½œç”¨       |                  è·å–æ–¹å¼                   |
     | :---------: | :-----------------: | :--------------: | :-----------------------------------------: |
     |   request   | HttpServletRequest  | å°è£…æ‰€æœ‰è¯·æ±‚ä¿¡æ¯ |                  æ–¹æ³•å‚æ•°                   |
     |  response   | HttpServletResponse | å°è£…æ‰€æœ‰å“åº”ä¿¡æ¯ |                  æ–¹æ³•å‚æ•°                   |
     |   session   |     HttpSession     |   å°è£…æ‰€æœ‰ä¼šè¯   |              req.getSession()               |
     | application |   ServletContext    |     æ‰€æœ‰ä¿¡æ¯     | getServletContext() ã€ request.getServlet() |
     |     out     |     PrintWriter     |     è¾“å‡ºå¯¹è±¡     |            response.getWriter()             |
     |  exception  |      Exception      |     å¼‚å¸¸å¯¹è±¡     |                                             |
     |    page     |       Object        |   å½“å‰é¡µé¢å¯¹è±¡   |                                             |
     | pageContext |     PageContext     |   è·å–å…¶ä»–å¯¹è±¡   |                                             |
     |   config    |    ServletConfig    |     é…ç½®ä¿¡æ¯     |                                             |

2. å››å¤§ä½œç”¨åŸŸ

     1. page

          1. åœ¨å½“å‰é¡µé¢ä¸ä¼šé‡æ–°å®ä¾‹åŒ–

     2. request

          1. åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚é‡æ–°å®ä¾‹åŒ–ä¸€ä¸ªrequestå¯¹è±¡

     3. session

          1. ä¸€æ¬¡ä¼šè¯

          2. åªè¦å®¢æˆ·ç«¯ Cookieä¸­ ä¼ é€’çš„ Jsessionidä¸å˜ï¼Œsession ä¸ä¼šé‡æ–°å®ä¾‹åŒ–ï¼ˆä¸è¶…è¿‡é»˜è®¤æ—¶é—´ï¼‰

          3. å®é™…æœ‰æ•ˆæ—¶é—´

               1. æµè§ˆå™¨å…³é—­ï¼ŒCookie å¤±æ•ˆ

               2. é»˜è®¤æ—¶é—´ï¼Œåœ¨æ—¶é—´èŒƒå›´å†…æ— ä»»ä½•è¯·æ±‚äº¤äº’ï¼Œåœ¨ tomcat çš„ web.xml ä¸­é…ç½®

                    ```xml
                    <seesion-config>
                    	<session-timeout>30</session-timeout>
                    </seesion-config>
                    ```

     4. application

          1. åªæœ‰åœ¨tomcatå¯åŠ¨é¡¹ç›®æ—¶æ‰ä¼šå®ä¾‹åŒ–ï¼Œå…³é—­tomcatæ—¶é”€æ¯ application

## 2ã€SpringMVC ä½œç”¨åŸŸä¼ å€¼çš„å‡ ç§æ–¹å¼

1. ä½¿ç”¨åŸç”Ÿ Serlvet

     1. åœ¨HandlerMethod å‚æ•°ä¸­æ·»åŠ ä½œç”¨åŸŸå¯¹è±¡

          ```java
          @RequestMapping("demo")
          public String demo(HttpServletRequest req,HttpSession sessionParam){
              // requestä½œç”¨åŸŸ
              req.setAttribute("req","reqçš„å€¼");
              // sessionä½œç”¨åŸŸ
              HttpSession session = req.getSession();
              session.setAttribute("session","sessionçš„å€¼");
              sessionParam.setAttribute("sessionParam","sessionParamçš„å€¼");
              // applicationä½œç”¨åŸŸ
              ServletContext application = req.getServletContext();
              application.setAttribute("application","applicationçš„å€¼");
              return "index";
          }
          ```

     2. ä½¿ç”¨mapé›†åˆ

          1. æŠŠ map ä¸­å†…å®¹æ”¾åˆ° request ä½œç”¨åŸŸä¸­

          2. Spring ä¼šå¯¹ map é›†åˆé€šè¿‡ BindingAwareModelMap è¿›è¡Œå®ä¾‹åŒ–

               ```JAVA
               @RequestMapping("demo2")
               public String demo2(Map<String,Object> map){
                   System.out.println(map.getClass());
                   map.put("map","mapçš„å€¼");
                   return  "index";
               }
               ```

          3. ä½¿ç”¨ SpringMVC ä¸­ Model æ¥å£

               1. æŠŠ å†…å®¹æœ€ç»ˆæ”¾å…¥ request ä½œç”¨åŸŸä¸­ 

                    ```java
                    @RequestMapping("demo3")
                    public String demo3(Model model){
                        model.addAttribute("model","modelçš„å€¼");
                        return "index";
                    }
                    ```

          4. ä½¿ç”¨ SpringMVC ä¸­ ModelAndView  ç±»

               ```java
               @RequestMapping("demo4")
               public ModelAndView demo4(){
                   ModelAndView mav = new ModelAndView("index");
                   mav.addObject("mav","mavçš„å€¼");
                   return mav;
               }
               ```

## 3ã€æ–‡ä»¶ä¸‹è½½

1. è®¿é—®èµ„æºæ—¶å“åº”å¤´å¦‚æœæ²¡æœ‰è®¾ç½® Content-Dispositionï¼Œæµè§ˆå™¨é»˜è®¤æŒ‰ç…§inlineå€¼è¿›è¡Œå¤„ç†

     1. inline  èƒ½æ˜¾ç¤ºå°±æ˜¾ç¤ºï¼Œä¸èƒ½æ˜¾ç¤ºå°±ä¸‹è½½

2. åªéœ€è¦ä¿®æ”¹å“åº”å¤´ä¸­  Context-Disposition = â€œattachementï¼›filename= æ–‡ä»¶åâ€

     1. attachement  ä¸‹è½½ï¼Œä»¥é™„ä»¶å½¢å¼ä¸‹è½½
     2. filename  =  å€¼å°±æ˜¯ä¸‹è½½æ—¶æ˜¾ç¤ºçš„æ–‡ä»¶åå­—

3. å®ç°æ­¥éª¤ï¼š

     1. å¯¼å…¥ jar åŒ…

          1. commons-fileupload-1.3.1.jar
          2. commons-io-2.2.jar

     2. åœ¨ jsp ä¸­æ·»åŠ è¶…é“¾æ¥ï¼Œè®¾ç½®ä¸‹è½½æ–‡ä»¶

          1. åœ¨ SpringMVC ä¸­è¦æ”¾è¡Œé™æ€èµ„æº

          ```html
          <a href="download?fileName=1.pdf">ä¸‹è½½pdf</a>
          ```

     3. åœ¨ controller 

          ```java
          @RequestMapping("download")
          @ResponseBody
          public void download(String fileName, HttpServletResponse res, HttpServletRequest req) throws IOException {
              // è®¾ç½®å“åº”æµä¸­æ–‡è¿›è¡Œä¸‹è½½
              res.setHeader("Content-Disposition","attachment;filename="+fileName);
              // æŠŠäºŒè¿›åˆ¶æµæ”¾å…¥å“åº”ä½“ä¸­
              ServletOutputStream os = res.getOutputStream();
              String path = req.getServletContext().getRealPath("files");
              File file = new File(path, fileName);
              System.out.println(path);
              byte[] bytes = FileUtils.readFileToByteArray(file);
              os.write(bytes);
              os.flush();
              os.close();
          }
          ```

## 4ã€æ–‡ä»¶ä¸Šä¼ 

1. åŸºäº apache çš„  commons-fileupload.jar  å®Œæˆæ–‡ä»¶ä¸Šä¼ 

2. MultipartResolver ä½œç”¨ï¼š

     1. æŠŠå®¢æˆ·ç«¯æ–‡ä»¶æµè½¬åŒ–ä¸º MutipartFile å°è£…ç±»
     2. é€šè¿‡ MutipartFile å°è£…ç±»è·å–åˆ°æ–‡ä»¶æµ

3. è¡¨å•æ•°æ®ç±»å‹

     1. åœ¨ <form> çš„ enctype å±æ€§æ§åˆ¶è¡¨å•ç±»å‹
     2. é»˜è®¤å€¼ application/x-www-form-urlencoded ï¼Œæ™®é€šè¡¨å•æ•°æ®ï¼ˆå°‘é‡æ–‡å­—ä¿¡æ¯ï¼‰
     3. text / plain  å¤§æ–‡å­—é‡ä½¿ç”¨çš„ç±»å‹ï¼Œé‚®ä»¶ï¼Œè®ºæ–‡
     4. multipart / form-data   è¡¨å•ä¸­åŒ…å«äºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹

4. å®ç°æ­¥éª¤ï¼š

     1. å¯¼å…¥  SpringMVC åŒ… å’Œ apache æ–‡ä»¶ä¸Šä¼   commons-fileupload ã€ commons-io åŒ…

     2. jspé¡µé¢

          ```html
          <form action="upload" enctype="multipart/form-data" method="post">
            å§“å:<input type="text" name="name"/><br/>
            æ–‡ä»¶:<input type="file" name="file"/><br/>
            <input type="submit" value="æäº¤"/>
          </form>
          ```

     3. é…ç½® SpringMVC.xml

          > ä» multipartResolver è§†å›¾è§£æå™¨å¼€å§‹  æ‰æ˜¯ä¸Šçš„ä½œç”¨

          ```xml
          <!-- æ³¨è§£æ‰«æ -->
          <context:component-scan base-package="com.bjsxt.controller"/>
          
          <!-- æ³¨è§£é©±åŠ¨ -->
          <mvc:annotation-driven/>
          
          <!-- é™æ€èµ„æº mappingæ˜¯urlçš„è·¯å¾„  locationæ˜¯æœ¬åœ°è·¯å¾„ -->
          <mvc:resources mapping="/files/**" location="/files/"/>
          
          <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
              <property name="prefix" value="/"/>
              <property name="suffix" value=".jsp"/>
          </bean>
          
          <!-- multipartResolver è§£æå™¨ -->
          <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
              <!-- é™åˆ¶ä¸Šä¼ å¤§å° -->
              <property name="maxUploadSize" value="3163568"/>
          </bean>
          
          <bean id="exceptionResolver" class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
              <property name="exceptionMappings">
                  <!-- å¦‚æœæŠ¥ä»€ä¹ˆå¼‚å¸¸ï¼Œå°±è½¬åˆ°ä»€ä¹ˆé¡µé¢ï¼Œè¿™é‡Œä¸èƒ½åŠ  /  .jsp  å› ä¸ºä¸Šé¢æœ‰è‡ªå®šä¹‰è§†å›¾è§£æå™¨ -->
                  <props>
                      <prop key="org.springframework.web.multipart.MaxUploadSizeExceededException">error</prop>
                  </props>
              </property>
          </bean>
          ```

     4. ç¼–å†™æ§åˆ¶å™¨ç±»

          1. MultipartFile  å¯¹è±¡åå¿…é¡»å’Œ <input type"file" name=â€å±æ€§åâ€œ>  ä¸­çš„å±æ€§åå¿…é¡»ä¸€è‡´

               ```java
               @RequestMapping("upload")
               public String upload(MultipartFile file,String name) throws IOException {
                   System.out.println("name: "+name);
                   String fileName = file.getOriginalFilename();
                   String suffix = fileName.substring(fileName.lastIndexOf("."));
                   String type = ".png";
                   if (suffix.equalsIgnoreCase(type)){
                       String uuid = UUID.randomUUID().toString();
                       File path = new File("F:/study/IDEA/å°šå­¦å ‚/é«˜çº§æ¡†æ¶/SpringMVC/SpringMVC05/web/uploadFiles/"+name+"_"+uuid+suffix);
                       FileUtils.copyInputStreamToFile(file.getInputStream(),path);
                       System.out.println(path);
                       return "index";
                   } else {
                       System.out.println("ç±»å‹ä¸å¯¹");
                       return "error";
                   }
               }
               ```

><center><b><font color=blue >å¥½äº†åˆ°è¿™æˆ‘ä»¬çš„æ•™ç¨‹ä¹Ÿç»“æŸäº†ğŸ˜‰</font></b></center>
>
><center><b><font color=blue >å¸Œæœ›ä»¥ä¸Šæ–¹æ³•å¯ä»¥å¸®åˆ°æ‚¨ï¼Œç¥æ‚¨å·¥ä½œæ„‰å¿«ï¼ğŸ’–</font></b></center>
>
><center>ğŸ‘‡</center>
><center><b><font color=pink >å¯¹æ‚¨æœ‰å¸®åŠ©çš„è¯è®°ç‚¹èµå¾—æ”¶è—å“¦ï¼ğŸ‘</font></b></center>
><center><font color=blue>æˆ‘æ˜¯</font>       <font color=red>Xiangæƒ³</font>     <font color=blue>ä»å°ç™½ä¸€æ­¥ä¸€æ­¥åœ°å˜æˆå·¥å…·äºº ğŸ˜›</font></center>